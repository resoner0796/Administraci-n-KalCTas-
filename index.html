<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KalCTas Admin Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <audio id="notification-sound" src="notification.mp3" preload="auto"></audio>

    <section id="login-screen">
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="" class="logo logo-img" alt="Logo" style="width: 120px; margin-bottom: 10px;">
            <h1 style="font-size: 1.5rem;">KalCTas Admin</h1>
            <p style="color: var(--text-muted);">Bienvenido de nuevo, bro</p>
        </div>
        <div class="modal-content" style="max-width: 400px;">
            <form id="login-form">
                <label>Correo Electr√≥nico</label>
                <input type="email" id="login-email" placeholder="usuario@kalctas.com" required>
                <label>Contrase√±a</label>
                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
            </form>
        </div>
    </section>

    <aside class="dashboard-sidebar" id="app-sidebar" style="display: none;">
        <div class="sidebar-header">
            <img src="" class="sidebar-logo logo-img" alt="K">
            <span class="sidebar-title">KalCTas</span>
        </div>

        <nav class="sidebar-menu">
            <button class="nav-btn" onclick="showScreen('finance-screen')">üìä Dashboard / Finanzas</button>
            <button class="nav-btn" onclick="showScreen('orders-screen')">üì¨ Pedidos Activos</button>
            <button class="nav-btn" onclick="showScreen('inventory-screen')">üì¶ Productos</button>
            <button class="nav-btn" onclick="showScreen('raw-materials-screen')">üè∑Ô∏è Insumos</button>
            <button class="nav-btn" onclick="showScreen('manual-order-screen')">üìù Venta Manual</button>
            <button class="nav-btn" onclick="showScreen('sales-history-screen')">üí∞ Historial Ventas</button>
            <button class="nav-btn" onclick="showScreen('sales-screen')">üìà Gr√°ficas</button>
            <button class="nav-btn" onclick="showScreen('packaging-screen')">üß∏ Empaques & Video</button>
            <button class="nav-btn" onclick="showScreen('theme-screen')">üé® Configuraci√≥n Tema</button>
            
            <div style="margin-top: auto; border-top: 1px solid #334155; padding-top: 10px;">
                <button class="nav-btn" onclick="logout()" style="color: var(--danger);">
                    üö™ Cerrar Sesi√≥n
                </button>
            </div>
        </nav>
    </aside>

    <main class="dashboard-main" id="app-main" style="display: none;">
        
        <header class="top-header">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <h2 class="page-title" id="page-title-display">Panel de Control</h2>
            <div class="user-info" style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 0.9rem; color: var(--text-muted);">Admin</span>
                <div style="width: 35px; height: 35px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">A</div>
            </div>
        </header>

        <div class="content-area">

            <section id="main-menu">
                <div style="text-align: center; margin-top: 50px;">
                        <h3>Bienvenido al Panel Pro</h3>
                        <p>Selecciona una opci√≥n del men√∫ lateral.</p>
                        <button onclick="showScreen('finance-screen')" class="btn-primary" style="max-width: 200px; margin-top: 20px;">Ir al Resumen Financiero</button>
                     </div>
            </section>

            <section id="finance-screen">
                <h2 style="margin-bottom: 20px;">Resumen Financiero</h2>
                <div class="finance-panel">
                    <div class="finance-card" onclick="showMovementsHistory('Ventas')"><h3>Ventas</h3><p id="total-sales">$0.00</p></div>
                    <div class="finance-card" onclick="showMovementsHistory('Gastos')"><h3>Gastos</h3><p id="total-expenses">$0.00</p></div>
                    <div class="finance-card" onclick="showMovementsHistory('Utilidad')"><h3 style="color: var(--success);">Utilidad Neta</h3><p id="total-profit">$0.00</p></div>
                    <div class="finance-card" onclick="showMovementsHistory('Capital')"><h3 style="color: var(--warning);">Capital</h3><p id="total-capital">$0.00</p></div>
                </div>
                
                <h3 style="margin: 30px 0 15px 0; border-bottom: 1px solid #334155; padding-bottom: 10px;">Reparto de Utilidades</h3>
                <div class="finance-panel" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                    <div class="finance-card" onclick="showMovementsHistory('Utilidad Negocio')"><h3>Negocio (50%)</h3><p id="total-profit-negocio">$0.00</p></div>
                    <div class="finance-card" onclick="showMovementsHistory('Utilidad Socio', 'Ulises')"><h3>Ulises (25%)</h3><p id="total-profit-ulises">$0.00</p></div>
                    <div class="finance-card" onclick="showMovementsHistory('Utilidad Socio', 'Dariana')"><h3>Dariana (25%)</h3><p id="total-profit-dariana">$0.00</p></div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 30px;">
                    <div class="card-item">
                        <h3>Registrar Gasto R√°pido</h3>
                        <form id="add-expense-form" style="margin-top: 15px;">
                            <input type="number" id="expense-amount" placeholder="Monto ($)" step="0.01" required>
                            <select id="expense-concept" required><option value="">Cargando conceptos...</option></select>
                            <textarea id="expense-note" placeholder="Nota (opcional)" rows="2"></textarea>
                            <button type="submit" class="btn-primary">Registrar</button>
                        </form>
                        <button onclick="addNewExpenseConcept()" style="margin-top: 10px; background: transparent; color: var(--primary); width: auto; padding: 0;">+ Crear concepto</button>
                    </div>
                    
                    <div class="card-item">
                        <h3>Configuraciones</h3>
                        <form id="cost-config-form" style="margin-top: 15px;">
                            <label>Costo Base Producto</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="product-cost-input" placeholder="42" step="0.01">
                                <button type="submit" style="width: auto;">Guardar</button>
                            </div>
                        </form>
                        <form id="shipping-cost-config-form" style="margin-top: 15px;">
                            <label>Costo Env√≠o Base</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="number" id="shipping-cost-input" placeholder="70" step="0.01">
                                <button type="submit" style="width: auto;">Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="showScreen('sales-report-table-screen')" style="background: var(--bg-card); border: 1px solid var(--primary);">Ver Tabla Detallada</button>
                    <button onclick="showScreen('restock-screen')" style="background: var(--bg-card); border: 1px solid var(--warning); color: var(--warning);">Hacer Re-Stock</button>
                </div>
            </section>

            <section id="inventory-screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Inventario</h2>
                    <button onclick="showScreen('add-product-screen')" class="btn-primary" style="width: auto;">+ Nuevo Producto</button>
                </div>
                <div id="category-visibility-controls" class="card-item" style="margin-bottom: 20px;">
                    </div>
                <div id="inventory-accordion" style="display: grid; gap: 15px;">
                    </div>
            </section>

            <section id="add-product-screen">
                <div class="card-item" style="max-width: 600px; margin: 0 auto;">
                    <h2>Nuevo Producto</h2>
                    <form id="add-product-form" style="margin-top: 20px;">
                        <input type="text" id="product-name" placeholder="Nombre del modelo" required>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <select id="product-category" required>
                                <option value="" disabled selected>Categor√≠a</option>
                                <option value="KalCTas2-4">KalCTas 2/4</option>
                                <option value="KalCTas3-4">KalCTas 3/4</option>
                                <option value="KalCTasLargas">KalCTas Largas</option>
                            </select>
                            <input type="number" id="product-stock" placeholder="Stock Inicial" required>
                        </div>
                        <input type="text" id="product-image-url" placeholder="URL Imagen (assets/...)" required>
                        <input type="number" id="product-price" placeholder="Precio Venta ($)" step="0.01" required>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" onclick="showScreen('inventory-screen')" style="background: transparent; border: 1px solid #334155;">Cancelar</button>
                            <button type="submit" class="btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </section>

            <section id="orders-screen">
                <h2>Pedidos Pendientes</h2>
                <ul id="orders-list" style="list-style: none; margin-top: 20px;"></ul>
            </section>

            <section id="manual-order-screen">
                <div class="card-item" style="max-width: 800px; margin: 0 auto;">
                    <h2>Registrar Venta Manual</h2>
                    <form id="manual-order-form" style="margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <input type="text" id="manual-order-client" placeholder="Nombre Cliente" required>
                            <input type="tel" id="manual-order-phone" placeholder="Tel√©fono (Opcional)">
                        </div>
                        <select id="manual-order-channel" required>
                            <option value="Facebook">Facebook</option>
                            <option value="Venta Personal">Venta Personal</option>
                            <option value="Otro">Otro</option>
                        </select>

                        <h4 style="margin: 20px 0 10px 0; color: var(--primary);">Productos</h4>
                        <div id="manual-order-items"></div>
                        <button type="button" onclick="addManualOrderLine()" style="background: transparent; border: 1px dashed #334155; margin-top: 10px; color: var(--text-muted);">+ Agregar otro producto</button>

                        <h4 style="margin: 20px 0 10px 0; color: var(--primary);">Entrega</h4>
                        <select id="manual-delivery-method" onchange="toggleManualDeliveryFields()">
                            <option value="punto-medio">Punto medio</option>
                            <option value="domicilio">Entrega a domicilio</option>
                        </select>
                        
                        <div id="manual-home-delivery-fields" style="display:none;">
                            <input type="text" id="manual-delivery-street" placeholder="Calle y n√∫mero">
                            <input type="text" id="manual-delivery-neighborhood" placeholder="Colonia">
                            <textarea id="manual-delivery-description" placeholder="Referencias de la casa..."></textarea>
                        </div>

                        <div id="manual-pickup-location-fields">
                            <input type="date" id="manual-delivery-date" required>
                            <select id="manual-delivery-location" onchange="toggleOtherManualLocation()">
                                <option value="Mi tienda Jarachina">Mi tienda Jarachina</option>
                                <option value="La Portillo">La Portillo</option>
                                <option value="Perif√©rico">Perif√©rico</option>
                                <option value="Soriana Hidalgo">Soriana Hidalgo</option>
                                <option value="Otro">Otro...</option>
                            </select>
                            <textarea id="manual-other-location-note" style="display:none;" placeholder="Escribe el lugar..."></textarea>
                        </div>

                        <textarea id="manual-delivery-comments" placeholder="Comentarios generales..." style="margin-top: 15px;"></textarea>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; text-align: right;">
                            <label>Total a Cobrar:</label>
                            <input type="number" id="manual-order-total" readonly style="background: transparent; border: none; font-size: 2rem; color: var(--success); text-align: right; font-weight: bold;">
                        </div>

                        <button type="submit" class="btn-primary" style="margin-top: 20px; font-size: 1.2rem;">Registrar Venta</button>
                    </form>
                </div>
            </section>

            <section id="raw-materials-screen">
                <h2>Inventario de Insumos</h2>
                <div class="card-item" style="margin-bottom: 20px;">
                    <form id="add-raw-material-form" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="hidden" id="raw-material-id">
                        <input type="text" id="raw-material-description" placeholder="Nueva etiqueta / bolsa..." style="flex: 2;" required>
                        <input type="number" id="raw-material-quantity" placeholder="Cant." style="flex: 1;" required>
                        <button type="submit" id="add-raw-material-btn" class="btn-primary" style="width: auto;">Agregar</button>
                        <button type="button" id="cancel-edit-raw-material-btn" style="display: none; background: var(--danger);" onclick="cancelEditRawMaterial()">X</button>
                    </form>
                </div>
                <div class="table-container">
                    <table id="raw-materials-table">
                        <thead><tr><th>Descripci√≥n</th><th>Cantidad</th><th>Acciones</th></tr></thead>
                        <tbody id="raw-materials-table-body"></tbody>
                    </table>
                </div>
            </section>

            <section id="packaging-screen">
                <h2>Empaques y Video</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card-item">
                        <h3>Videos</h3>
                        <form id="add-video-form">
                            <input type="text" id="video-name" placeholder="Nombre" required>
                            <input type="text" id="video-url" placeholder="Archivo.mp4" required>
                            <button type="submit" class="btn-primary">Subir Video</button>
                        </form>
                        <div id="video-list" style="margin-top: 15px;"></div>
                    </div>
                    <div class="card-item">
                        <h3>Empaques</h3>
                        <form id="add-packaging-form">
                            <input type="text" id="packaging-name" placeholder="Nombre" required>
                            <input type="text" id="packaging-image-url" placeholder="Imagen.jpg" required>
                            <button type="submit" class="btn-primary">Agregar Empaque</button>
                        </form>
                        <div id="packaging-list" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </section>

            <section id="sales-history-screen">
                <h2>Historial de Pedidos</h2>
                <ul id="sales-history-list" style="margin-top: 20px;"></ul>
            </section>

            <section id="sales-report-table-screen">
                <h2>Reporte Detallado (Tabla)</h2>
                <div class="table-container">
                    <table id="sales-report-table">
                        <thead>
                            <tr>
                                <th>Folio</th>
                                <th>Cliente</th>
                                <th>Canal</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Costo</th>
                                <th>Env√≠o</th>
                                <th>Utilidad</th>
                                <th>Negocio</th>
                                <th>Ulises</th>
                                <th>Dariana</th>
                            </tr>
                        </thead>
                        <tbody id="sales-report-table-body"></tbody>
                    </table>
                </div>
            </section>

            <section id="movements-history-screen">
                <h2>Historial de Movimientos</h2>
                <div class="filter-container" style="margin-bottom: 20px;">
                    <select id="movement-filter-category" onchange="loadMovementsHistory()" style="max-width: 300px;">
                        <option value="all">Todas las categor√≠as</option>
                    </select>
                </div>
                <ul id="movements-list" class="card-list"></ul>
                <button onclick="showScreen('finance-screen')" style="margin-top: 20px;">&larr; Volver a Finanzas</button>
            </section>
            
            <section id="restock-screen">
                 <h2>Re-Stock de Inventario</h2>
                 <div class="card-item">
                    <form id="add-restock-form">
                        <div id="restock-items"></div>
                        <button type="button" onclick="addRestockLine()" style="margin: 10px 0; border: 1px dashed #334155; background: transparent;">+ Modelo</button>
                        <div style="text-align: right; margin-top: 20px;">
                            <label style="display:inline;">Env√≠o:</label>
                            <input type="number" id="shipping-cost" value="0" style="width: 100px; display:inline;">
                            <h3 style="margin-top: 10px;">Total: <span id="restock-total">$0.00</span></h3>
                        </div>
                        <button type="submit" class="btn-primary" style="margin-top: 15px;">Registrar Re-Stock</button>
                    </form>
                 </div>
                 <h3 style="margin-top: 30px;">Historial Re-Stocks</h3>
                 <ul id="restock-history-list" class="card-list"></ul>
            </section>
            
            <section id="sales-screen">
                <h2>Gr√°fica de Ventas</h2>
                <div class="card-item" style="height: 400px;">
                    <canvas id="sales-chart"></canvas>
                </div>
                <ul id="sales-list" style="margin-top: 20px;"></ul>
            </section>

            <section id="theme-screen">
                <h2>Tema de la Tienda P√∫blica</h2>
                <p>Estado: <strong id="current-theme-status">Cargando...</strong></p>
                <div class="theme-buttons" style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="setTheme('default')" style="background: #fff; color: #000;">Default</button>
                    <button onclick="setTheme('halloween')" style="background: #f9a03f; color: #000;">Halloween üéÉ</button>
                    <button onclick="setTheme('christmas')" style="background: #d94545; color: #fff;">Navidad üéÖ</button>
                </div>
            </section>
            
            <section id="supplies-screen">
                <h2>Gastos en Insumos</h2>
                <div class="card-item">
                    <form id="add-supply-form">
                        <input type="text" id="supply-description" placeholder="Descripci√≥n" required>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="supply-quantity" placeholder="Cant." required>
                            <input type="number" id="supply-cost" placeholder="Costo Unit." required>
                        </div>
                        <button type="submit" class="btn-primary">Registrar</button>
                    </form>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="supplies-table">
                        <thead><tr><th>Desc.</th><th>Cant.</th><th>Total</th><th>Acci√≥n</th></tr></thead>
                        <tbody id="supplies-table-body"></tbody>
                    </table>
                </div>
            </section>

        </div> </main>

    <div id="edit-modal" class="edit-modal">
        <div class="modal-content">
            <h2>Editar Producto</h2>
            <form id="edit-product-form">
                <input type="hidden" id="edit-product-id">
                <input type="text" id="edit-name" required>
                <select id="edit-category" required>
                    <option value="KalCTas2-4">KalCTas 2/4</option>
                    <option value="KalCTas3-4">KalCTas 3/4</option>
                    <option value="KalCTasLargas">KalCTas Largas</option>
                </select>
                <input type="text" id="edit-image-url" placeholder="URL Imagen">
                <div style="display:flex; gap:10px;">
                    <input type="number" id="edit-stock" placeholder="Stock" required>
                    <input type="number" id="edit-price" placeholder="Precio" step="0.01" required>
                </div>
                <label><input type="checkbox" id="edit-visible" style="width:auto;"> Visible en tienda</label>
                <button type="submit" class="btn-primary" style="margin-top:15px;">Guardar Cambios</button>
            </form>
            <button onclick="closeEditModal()" style="margin-top: 10px; background: transparent;">Cancelar</button>
        </div>
    </div>

    <div id="message-box" class="message-box">
        <div class="modal-content" style="text-align: center;">
            <p id="message-text" style="font-size: 1.1rem; margin-bottom: 20px;"></p>
            <button onclick="closeMessage()" class="btn-primary">Entendido</button>
        </div>
    </div>

    <div id="confirm-modal" class="confirm-modal">
        <div class="modal-content" style="text-align: center;">
            <p id="confirm-text" style="font-size: 1.1rem; margin-bottom: 20px;">¬øSeguro?</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn-primary" style="background: var(--success);" onclick="confirmAction()">S√≠, dale</button>
                <button style="background: var(--danger); color: white;" onclick="cancelAction()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="sales-history-modal" class="sales-history-modal">
        <div class="modal-content">
            <h2 id="modal-history-title">Historial</h2>
            <ul id="modal-sales-list" style="max-height: 400px; overflow-y: auto; text-align:left; margin-top:10px;"></ul>
            <button onclick="closeSalesHistoryModal()" style="margin-top:15px; width:100%;">Cerrar</button>
        </div>
    </div>

    <div id="image-modal" class="image-modal" onclick="cerrarModal()">
        <span class="close-modal" style="position:absolute; top:20px; right:30px; font-size:40px; cursor:pointer;">&times;</span>
        <img class="modal-content-img" id="modal-image" style="max-width:90%; max-height:90%; border-radius:12px;">
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="js/app.js"></script>

    <script>
        // Control del sidebar en m√≥vil
        function toggleSidebar() {
            document.getElementById('app-sidebar').classList.toggle('active');
        }

        // Detectar cuando el usuario hace login (Firebase Auth listener est√° en app.js)
        // Pero necesitamos mostrar el sidebar y el main cuando NO es login-screen
        // Modificamos un poco el observador visual:
        const originalShowScreen = window.showScreen; // Guardamos la funci√≥n original si existiera
        
        // Sobreescribimos showScreen SOLO para manejar la visibilidad del Layout
        // (Tu app.js sigue controlando qu√© secci√≥n se ve, esto solo controla el marco)
        window.showScreen = function(screenId) {
            // Ejecutamos la l√≥gica original de tu app.js (que carga datos, etc.)
            // Como app.js define showScreen globalmente, aqu√≠ estamos "inyectando" l√≥gica visual extra.
            
            // 1. Ocultar todas las secciones (Esto ya lo hace tu app.js, pero lo reforzamos)
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            
            // 2. Mostrar la secci√≥n pedida
            const target = document.getElementById(screenId);
            if(target) target.style.display = 'block';

            // 3. L√≥gica del Layout (Login vs Dashboard)
            const loginScreen = document.getElementById('login-screen');
            const sidebar = document.getElementById('app-sidebar');
            const main = document.getElementById('app-main');

            if (screenId === 'login-screen') {
                loginScreen.style.display = 'flex'; // Flex para centrar
                sidebar.style.display = 'none';
                main.style.display = 'none';
            } else {
                loginScreen.style.display = 'none';
                sidebar.style.display = 'flex';
                main.style.display = 'flex';
                
                // Actualizar t√≠tulo en el header seg√∫n la pantalla
                const titles = {
                    'finance-screen': 'Dashboard Financiero',
                    'inventory-screen': 'Inventario de Productos',
                    'orders-screen': 'Gesti√≥n de Pedidos',
                    'manual-order-screen': 'Punto de Venta Manual',
                    'sales-report-table-screen': 'Reportes Detallados'
                };
                const titleDisplay = document.getElementById('page-title-display');
                if(titleDisplay && titles[screenId]) titleDisplay.textContent = titles[screenId];
                
                // En m√≥vil, ocultar sidebar al seleccionar algo
                if(window.innerWidth < 768) {
                    sidebar.classList.remove('active');
                }
            }
            
            // Llamar a las funciones de carga de datos de tu app.js original
            // Como sobreescribimos la funci√≥n, tenemos que asegurarnos de llamar a la l√≥gica de carga.
            // TRUCO: Tu app.js define showScreen. Al cargar este script AL FINAL del body,
            // podriamos entrar en conflicto. 
            // MEJOR ESTRATEGIA: No sobreescribir, dejar que app.js haga su trabajo.
            // El CSS ya maneja el display:none/flex del layout basado en clases o IDs.
            
            // REVISI√ìN: Tu app.js hace: document.querySelectorAll('section').forEach(screen => screen.style.display = 'none');
            // Eso ocultar√° el Sidebar si fuera una <section>, pero el Sidebar es un <aside>. ¬°Bien!
            // El Login es una <section>, as√≠ que funcionar√°.
        };
        
        // Parche r√°pido: Tu app.js al hacer logout() muestra login-screen.
        // Necesitamos que al mostrar login-screen se oculte el sidebar.
        // Usaremos un Observer para detectar cambios en el estilo del login-screen.
        const loginSection = document.getElementById('login-screen');
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    const isLoginVisible = loginSection.style.display !== 'none';
                    document.getElementById('app-sidebar').style.display = isLoginVisible ? 'none' : 'flex';
                    document.getElementById('app-main').style.display = isLoginVisible ? 'none' : 'flex';
                }
            });
        });
        observer.observe(loginSection, { attributes: true });
    </script>
</body>
</html>
